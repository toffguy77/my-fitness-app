# Environment Files Strategy

## Branch-Specific Approach

### Dev Branch (current)
✅ **Commit .env files** - для упрощения совместной разработки

```bash
# Add .env files to git (use force flag)
bash scripts/add-env-files.sh

# Or manually
git add -f .env.local
git add -f apps/api/.env
git add -f apps/web/.env.local
```

### Staging/Production Branches
❌ **Never commit .env files** - используйте GitHub Secrets и CI/CD

## Current Environment Files

### Root Level
- `.env.local` - Docker Compose и общие настройки
- `.gitignore.dev` - Специальный .gitignore для dev ветки

### Backend (`apps/api/`)
- `.env` - Backend конфигурация (PostgreSQL, JWT, logging)
- `.env.example` - Шаблон для других окружений

### Frontend (`apps/web/`)
- `.env.local` - Frontend конфигурация (API URL, feature flags)

## Security

### Development Credentials (committed in dev)
- Yandex.Cloud PostgreSQL development database
- Development JWT secret
- Local API endpoints
- **Safe to commit** - isolated development environment

### Production Credentials (never committed)
- Stored in GitHub Secrets
- Injected via CI/CD
- Rotated regularly
- **Never commit to git**

## Quick Commands

```bash
# Check current environment
cat apps/api/.env | grep DATABASE_URL

# Test database connection
make -f Makefile.db db-status

# Start development
make dev

# View all environment variables
env | grep -E "(DATABASE|API|JWT)"
```

## Migration Between Branches

### From dev to staging/production
1. Remove .env files from git
2. Store credentials in GitHub Secrets
3. Update CI/CD to use secrets
4. Never commit .env files again

### From staging/production to dev
1. Copy .env.example files
2. Fill with development credentials
3. Add to git with `-f` flag
4. Commit and push

## Troubleshooting

### "Files are ignored by .gitignore"
```bash
# Use force flag
git add -f .env.local

# Or use the script
bash scripts/add-env-files.sh
```

### "Wrong credentials"
```bash
# Check ENV_SETUP.md for correct values
cat ENV_SETUP.md

# Or check .env.example
cat apps/api/.env.example
```

### "Database connection failed"
```bash
# Verify credentials
make -f Makefile.db db-status

# Check if database is accessible
ping c-c9q1384cb8tqrg09o8n4.rw.mdb.yandexcloud.net
```

## Best Practices

1. ✅ Commit .env in **dev branch only**
2. ✅ Use .env.example for templates
3. ✅ Document all variables in ENV_SETUP.md
4. ✅ Use different credentials per environment
5. ❌ Never commit production credentials
6. ❌ Never reuse dev credentials in production
7. ❌ Never commit .env in main/staging branches

## See Also

- `ENV_SETUP.md` - Complete environment setup guide
- `docs/POSTGRESQL_SETUP.md` - Database configuration
- `apps/api/.env.example` - Backend environment template
