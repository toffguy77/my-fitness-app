# Roadmap: Phase 4-7 - Долгосрочный план развития

**Дата создания:** Январь 2025  
**Статус:** Планирование  
**Предыдущие фазы:** Phase 1-3 (реализовано)

---

## Обзор

Этот документ описывает долгосрочный план развития My Fitness App на следующие 4 фазы (Phase 4-7), объединяющий улучшения UX, аналитику, коммуникацию и расширенную функциональность.

---

## Phase 4: Улучшения UX и визуализация данных

**Приоритет:** Высокий  
**Срок:** 8-10 недель  
**Статус:** Планирование

### Цели
- Улучшить пользовательский опыт через современные паттерны UI
- Добавить визуализацию данных для лучшего понимания прогресса
- Оптимизировать производительность приложения

### Компоненты

#### 4.1 UX улучшения (2-3 недели)
- ✅ Замена `alert()` на toast-уведомления
- ✅ Улучшение индикаторов загрузки (spinner, skeleton loaders)
- ✅ Оптимистичные обновления UI

#### 4.2 Визуализация данных (3-4 недели)
- ✅ График веса за период
- ✅ Графики КБЖУ (калории, макронутриенты)
- ✅ Прогресс-бары для визуализации прогресса
- ✅ Улучшение страницы отчетов (вкладки, фильтры, группировка)

#### 4.3 Дополнительная функциональность (2-3 недели)
- ✅ Экспорт данных (CSV, JSON, опционально PDF)
- ✅ Поиск и фильтрация в отчетах
- ✅ Пагинация для больших списков

**Подробный план:** См. `Phase4_BRD.md` (будет создан)

---

## Phase 5: Коммуникация и база продуктов

**Приоритет:** Высокий  
**Срок:** 6-8 недель  
**Статус:** Планирование

### Цели
- Улучшить коммуникацию между тренером и клиентом
- Ускорить ввод данных о питании через базу продуктов
- Повысить точность данных через стандартизированные КБЖУ

### Компоненты

#### 5.1 Чат с тренером (3-4 недели)
**Тип:** Реальное время (WebSocket)

**Функциональность:**
- Двусторонний чат между тренером и клиентом
- WebSocket соединение для real-time сообщений
- История сообщений
- Уведомления о новых сообщениях
- Индикатор "печатает..."
- Отправка файлов/изображений (опционально)

**Технические детали:**
- Supabase Realtime для WebSocket
- Таблица `messages` в БД
- Компоненты: `ChatWindow.tsx`, `MessageList.tsx`, `MessageInput.tsx`
- Интеграция в `/app/coach/[clientId]` и `/app/dashboard`

**Миграции БД:**
- `v5.1_add_messages_table.sql`
- RLS политики для сообщений

**Приоритет:** Высокий

#### 5.2 База продуктов (3-4 недели)
**Источник:** Интеграция с внешним API (Open Food Facts, USDA)

**Функциональность:**
- Поиск продуктов по названию
- Автозаполнение при вводе питания
- Отображение КБЖУ из базы
- Возможность добавления собственных продуктов
- История часто используемых продуктов
- Избранные продукты

**Технические детали:**
- Интеграция с Open Food Facts API (или USDA)
- Таблица `products` для кэширования популярных продуктов
- Компонент `ProductSearch.tsx`
- Интеграция в `/app/nutrition` и `/app/dashboard` (AddMealModal)

**API интеграция:**
- Open Food Facts: https://world.openfoodfacts.org/data
- USDA FoodData Central: https://fdc.nal.usda.gov/

**Миграции БД:**
- `v5.2_add_products_table.sql`
- `v5.2_add_user_products_table.sql` (для пользовательских продуктов)

**Приоритет:** Высокий

**Подробный план:** См. `Phase5_BRD.md` (будет создан)

---

## Phase 6: PWA и инвайт-система

**Приоритет:** Средний  
**Срок:** 4-5 недель  
**Статус:** Планирование

### Цели
- Сделать приложение доступным как мобильное (PWA)
- Упростить привлечение клиентов через инвайт-коды
- Улучшить мобильный опыт использования

### Компоненты

#### 6.1 Progressive Web App (PWA) (2-3 недели)
**Функциональность:**
- Web App Manifest (`manifest.json`)
- Service Worker для offline режима
- Кэширование статических ресурсов
- Установка на домашний экран
- Push-уведомления (опционально)
- Офлайн режим для просмотра данных

**Технические детали:**
- Next.js PWA plugin (`next-pwa`)
- Стратегии кэширования (Cache First, Network First)
- Офлайн страница
- Индикатор подключения к сети

**Приоритет:** Средний

#### 6.2 Инвайт-коды для тренеров (2 недели)
**Функциональность:**
- Генерация уникальных инвайт-кодов для тренеров
- Страница регистрации по инвайт-коду
- Автоматическое назначение тренера при регистрации
- Статистика использования инвайт-кодов
- Ограничение количества использований (опционально)

**Технические детали:**
- Таблица `invite_codes` в БД
- Генерация кодов в `/app/coach` или `/admin`
- Страница `/register?code=XXXXX`
- Автоматическое связывание `coach_id` при регистрации

**Миграции БД:**
- `v6.2_add_invite_codes_table.sql`

**Приоритет:** Средний

**Подробный план:** См. `Phase6_BRD.md` (будет создан)

---

## Phase 7: OCR и расширенная функциональность

**Приоритет:** Низкий  
**Срок:** 6-8 недель  
**Статус:** Планирование (опционально)

### Цели
- Упростить ввод данных через сканирование этикеток
- Добавить дополнительные функции для вовлеченности

### Компоненты

#### 7.1 OCR для сканирования этикеток (4-5 недель)
**Функциональность:**
- Загрузка фото этикетки продукта
- Распознавание текста (название, КБЖУ)
- Автоматическое заполнение формы питания
- Подтверждение распознанных данных пользователем

**Технические детали:**
- Интеграция с OCR API (Tesseract.js или внешний сервис)
- Компонент `PhotoUpload.tsx`
- Обработка изображений на клиенте или сервере
- Интеграция с базой продуктов (сопоставление распознанного текста)

**Варианты реализации:**
1. **Tesseract.js** (клиентская обработка) - бесплатно, но медленнее
2. **Google Cloud Vision API** - точнее, но платно
3. **AWS Textract** - хорошая точность, платно

**Приоритет:** Низкий (можно отложить)

#### 7.2 Социальные функции (2-3 недели)
**Функциональность:**
- Публичные профили (опционально)
- Достижения и бейджи
- Лидерборды (опционально)
- Публикация прогресса в социальных сетях

**Приоритет:** Низкий (можно отложить или исключить)

**Подробный план:** См. `Phase7_BRD.md` (будет создан, если потребуется)

---

## Приоритизация и зависимости

### Критичный путь
1. **Phase 4** → **Phase 5** → **Phase 6** → **Phase 7**
   - Каждая фаза может начинаться после завершения предыдущей
   - Некоторые компоненты Phase 4 и Phase 5 можно делать параллельно

### Параллельная разработка
- Phase 4.1 (UX) и Phase 4.2 (Графики) можно делать параллельно
- Phase 5.1 (Чат) и Phase 5.2 (База продуктов) можно делать параллельно

### Опциональные компоненты
- Phase 7.1 (OCR) - можно отложить или исключить
- Phase 7.2 (Социальные функции) - можно отложить или исключить
- Phase 4.3 (Экспорт PDF) - опционально

---

## Технические зависимости

### Новые библиотеки
```json
{
  "recharts": "^2.10.0", // графики (Phase 4)
  "react-hot-toast": "^2.4.1", // toast уведомления (Phase 4)
  "papaparse": "^5.4.1", // экспорт CSV (Phase 4)
  "@supabase/realtime-js": "^2.x", // WebSocket для чата (Phase 5)
  "next-pwa": "^5.x", // PWA (Phase 6)
  "tesseract.js": "^5.x" // OCR (Phase 7, опционально)
}
```

### Внешние сервисы
- **Open Food Facts API** - база продуктов (Phase 5)
- **Google Cloud Vision API** или **AWS Textract** - OCR (Phase 7, опционально)

---

## Метрики успеха

### Phase 4
- Увеличение времени на сайте на 20%+
- Увеличение частоты использования отчетов на 30%+
- Снижение времени загрузки страниц на 15%+

### Phase 5
- Увеличение частоты коммуникации тренер-клиент на 50%+
- Снижение времени ввода питания на 40%+
- Увеличение точности данных на 25%+

### Phase 6
- Увеличение мобильного использования на 30%+
- Увеличение конверсии регистраций через инвайт-коды на 20%+

### Phase 7
- Снижение времени ввода данных через OCR на 60%+
- Увеличение вовлеченности через социальные функции (если реализовано)

---

## Риски и митигация

### Риск 1: Сложность WebSocket для чата
**Митигация:** Использовать Supabase Realtime (готовое решение), начать с простой реализации

### Риск 2: Зависимость от внешних API для продуктов
**Митигация:** Кэширование популярных продуктов в БД, fallback на ручной ввод

### Риск 3: Производительность PWA
**Митигация:** Оптимизация стратегий кэширования, lazy loading компонентов

### Риск 4: Точность OCR
**Митигация:** Использовать проверенные API (Google Cloud Vision), всегда требовать подтверждение пользователя

---

## Временная шкала (примерная)

- **Q1 2025:** Phase 4 (UX и аналитика)
- **Q2 2025:** Phase 5 (Чат и база продуктов)
- **Q3 2025:** Phase 6 (PWA и инвайты)
- **Q4 2025:** Phase 7 (OCR, опционально)

**Общий срок:** 12-18 месяцев (в зависимости от команды и приоритетов)

---

## Следующие шаги

1. ✅ Создать детальный BRD для Phase 4
2. ⏳ Начать реализацию Phase 4.1 (UX улучшения)
3. ⏳ Подготовить техническую документацию для Phase 5
4. ⏳ Исследовать API для базы продуктов

---

**Последнее обновление:** Январь 2025  
**Версия документа:** 1.0

