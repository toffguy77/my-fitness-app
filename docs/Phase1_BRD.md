# BRD - Business Requirements Document
# Phase 1: MVP - Цифровой дневник питания

**Версия:** 1.0.0  
**Дата:** Декабрь 2025  
**Статус:** Реализовано  
**Следующая версия:** Phase 2 v2.0.0

---

## 1. Бизнес-контекст

### 1.1 Проблема

Клиенты фитнес-тренеров и нутрициологов нуждаются в удобном инструменте для:
- Отслеживания ежедневного питания (КБЖУ)
- Ведения отчетов о питании для тренера
- Просмотра сводки по прогрессу
- Самоконтроля и мотивации

**Текущие решения (Excel, Telegram, блокноты) имеют ограничения:**
- Неудобны с мобильного устройства
- Теряется история и контекст
- Нет автоматической аналитики прогресса
- Сложно отслеживать дефицит/профицит калорий

### 1.2 Целевая аудитория

- **Основные пользователи:** Клиенты тренеров и нутрициологов
- **Вторичные пользователи:** Тренеры и нутрициологи (через админ-панель, не реализовано в MVP)

### 1.3 Бизнес-цели MVP

1. **Упростить процесс ввода данных** о питании для клиентов
2. **Обеспечить прозрачность прогресса** для клиента
3. **Снизить нагрузку на тренера** по сбору отчетов
4. **Создать основу** для будущего расширения функционала

### 1.4 Ограничения MVP

**Сознательно исключено из MVP:**
- Кабинет тренера (реализовано в Phase 2)
- Отслеживание тренировок (заглушка)
- Автозаполнение КБЖУ по фото (OCR/поиск продуктов)
- Внутренний мессенджер
- Сложные графики и дашборды
- Автоматическая оплата
- Социальные функции

---

## 2. Функциональные требования

### 2.1 Авторизация и безопасность

**Требование:** Система авторизации через email/password.

**Функциональность:**
- ✅ Страница логина (`/login`)
- ✅ Авторизация через Supabase Auth
- ✅ Защита маршрутов (редирект на логин при отсутствии сессии)
- ✅ Выход из системы
- ✅ Проверка авторизации на всех страницах
- ✅ Обработка ошибок авторизации

**Бизнес-ценность:**
- Безопасный доступ к данным
- Индивидуальные аккаунты для каждого клиента
- Основа для будущей ролевой модели

**Приоритет:** Критический

---

### 2.2 Дашборд клиента

**Требование:** Главная страница после авторизации с обзором прогресса.

**Функциональность:**

#### 2.2.1 Сводка по питанию за неделю
- Отображение средних значений КБЖУ за день
- Расчет дефицита/профицита калорий
- Количество дней с отчетами (из 7)
- Визуальная индикация (профицит/дефицит/норма)

**Данные:**
- Логи за последние 7 дней из таблицы `daily_logs`
- Активные цели из таблицы `nutrition_targets`

**Расчеты:**
- Средние КБЖУ: `total / daysLogged`
- Дефицит/профицит: `actual - target`
- Процент выполнения: `(daysLogged / 7) * 100`

#### 2.2.2 Сводка по тренировкам
- **Статус:** Заглушка (MVP)
- **Отображение:** Информационное сообщение о том, что функция в разработке
- **Метрики:** Запланировано/выполнено (заглушка)

#### 2.2.3 Активные программы
- Отображение текущего плана питания
- КБЖУ цели на день
- Статус активности

#### 2.2.4 Быстрые действия
- Кнопка "Ввести питание" → `/nutrition`
- Кнопка "Отчеты" → `/reports`

**Бизнес-ценность:**
- Быстрый обзор прогресса
- Мотивация через визуализацию
- Удобная навигация

**Приоритет:** Критический

---

### 2.3 Ввод данных о питании

**Требование:** Страница для детального ввода данных о питании за день.

**Функциональность:**

#### 2.3.1 Управление приемами пищи
- ✅ Добавление нового приема пищи (кнопка "+ Добавить прием пищи")
- ✅ Удаление приема пищи (кнопка "Удалить")
- ✅ Редактирование названия приема пищи
- ✅ Минимум 1 прием пищи всегда присутствует
- ✅ Дефолтное значение веса: 100г

#### 2.3.2 Ввод данных для каждого приема
**Поля:**
- Название (текст, редактируемое)
- Вес (г) - число, по умолчанию 100г
- Калории (число)
- Белки (г) - число
- Жиры (г) - число
- Углеводы (г) - число
- Фото (file input) - UI готов, обработка не реализована

**Валидация:**
- Поля ввода принимают только числа
- Пустые значения обрабатываются как 0
- Визуальное выделение полей ввода (белый фон, рамка)

#### 2.3.3 Автоматические расчеты
- ✅ Суммарные КБЖУ рассчитываются автоматически
- ✅ Отображение прогресса относительно целей (progress bars)
- ✅ Визуальная индикация превышения/недобора
- ✅ Обновление в реальном времени при изменении данных

#### 2.3.4 Дополнительные данные
- ✅ Уровень голода (1-10) - слайдер с текстовыми описаниями:
  - 1: Совсем нет голода
  - 2: Очень слабый голод
  - 3: Слабый голод
  - 4: Легкий голод
  - 5: Умеренный голод
  - 6: Заметный голод
  - 7: Сильный голод
  - 8: Очень сильный голод
  - 9: Нестерпимый голод
  - 10: Зверский голод
- ✅ Комментарий к дню (textarea)

#### 2.3.5 Сохранение
- ✅ Валидация: проверка наличия данных хотя бы в одном приеме пищи
- ✅ Upsert в таблицу `daily_logs` (обновление если запись существует, создание если нет)
- ✅ Конфликт по ключу: `user_id, date`
- ✅ Состояния сохранения: idle → saving → saved → idle
- ✅ Редирект на дашборд после успешного сохранения
- ✅ Обновление данных через `router.refresh()`
- ✅ Обработка ошибок сохранения

**Бизнес-ценность:**
- Удобный ввод данных с мобильного
- Автоматический подсчет КБЖУ
- Нет необходимости в ручных расчетах

**Приоритет:** Критический

---

### 2.4 Отчеты

**Требование:** Просмотр истории отчетов с группировкой по неделям.

**Функциональность:**

#### 2.4.1 Отчет за сегодня
- Отдельный блок с данными за сегодня
- Отображение КБЖУ
- Комментарий (если есть)

#### 2.4.2 Группировка по неделям
- Группировка всех отчетов по неделям года
- Отображение диапазона дат недели
- Список дней недели с данными
- Сортировка по дате (новые сверху)

**Технические детали:**
- Расчет номера недели через `getWeekKey()`
- Форматирование дат на русском языке

**Бизнес-ценность:**
- Исторический обзор прогресса
- Удобная навигация по периодам
- Мотивация через визуализацию истории

**Приоритет:** Высокий

---

## 3. Нефункциональные требования

### 3.1 Технические требования

**Платформа:**
- ✅ Progressive Web App (PWA-ready)
- ✅ Адаптивный дизайн (mobile-first)
- ✅ Работа в браузере (не требует нативных приложений)

**Производительность:**
- ✅ Быстрая загрузка данных
- ✅ Оптимистичные обновления UI
- ✅ Мемоизация расчетов через `useMemo`
- ✅ Обработка ошибок загрузки

**UX требования:**
- ✅ Интуитивный интерфейс
- ✅ Визуальная обратная связь при сохранении
- ✅ Понятные сообщения об ошибках
- ✅ Визуальное выделение интерактивных элементов

---

## 4. Модель данных

### 4.1 Таблицы Supabase

#### `profiles`
- `id` (UUID, PK) - ссылается на `auth.users.id`
- `email` (text)
- `full_name` (text)
- `role` (enum: 'client' | 'coach') - не используется в MVP
- `coach_id` (UUID, FK) - не используется в MVP
- `avatar_url` (text)
- `created_at` (timestamp)
- `updated_at` (timestamp)

#### `nutrition_targets`
- `id` (UUID, PK)
- `user_id` (UUID, FK → `profiles.id`)
- `calories` (integer)
- `protein` (integer)
- `fats` (integer)
- `carbs` (integer)
- `day_type` (text) - 'training' | 'rest' (в MVP используется только 'training')
- `is_active` (boolean)
- `created_at` (timestamp)

#### `daily_logs`
- `id` (UUID, PK)
- `user_id` (UUID, FK → `profiles.id`)
- `date` (date)
- `target_type` (text) - 'training' | 'rest' (в MVP всегда 'training')
- `actual_calories` (integer)
- `actual_protein` (integer)
- `actual_fats` (integer)
- `actual_carbs` (integer)
- `hunger_level` (integer, 1-10)
- `energy_level` (integer, 1-10)
- `notes` (text)
- Unique constraint: `(user_id, date)`

---

## 5. Пользовательские сценарии

### Сценарий 1: Первый вход
1. Пользователь открывает `/login`
2. Вводит email и password
3. Нажимает "Войти"
4. Редирект на дашборд `/`
5. Видит пустую сводку (нет данных за неделю)
6. Нажимает "Ввести данные" или "Ввести питание"
7. Переходит на `/nutrition`

### Сценарий 2: Ввод питания
1. Пользователь на странице `/nutrition`
2. Видит форму с одним приемом пищи
3. Вводит данные о первом приеме пищи
4. Нажимает "+ Добавить прием пищи"
5. Добавляет второй прием пищи
6. Вводит данные
7. Настраивает уровень голода
8. Добавляет комментарий
9. Нажимает "Сохранить отчет"
10. Видит статус "Сохранено"
11. Автоматический редирект на дашборд
12. Видит обновленную сводку

### Сценарий 3: Просмотр отчетов
1. Пользователь на дашборде
2. Нажимает "Отчеты"
3. Видит отчет за сегодня (если есть)
4. Видит группировку по неделям
5. Может вернуться на дашборд через "← Назад"

---

## 6. Метрики успеха MVP

### Количественные метрики:
- ✅ Клиенты могут вводить данные о питании ежедневно
- ✅ Данные сохраняются корректно (100% успешных сохранений)
- ✅ Сводка отображается правильно
- ✅ Нет критических ошибок при использовании

### Качественные метрики:
- Удобство использования с мобильного устройства
- Понятность интерфейса
- Скорость ввода данных

---

## 7. Известные ограничения MVP

### 7.1 Функциональные ограничения

1. **Только один тип дня:** Хардкод `day_type = 'training'` (исправлено в Phase 2)
2. **Нет кабинета тренера:** Тренер не видит данные клиентов (исправлено в Phase 2)
3. **Тренировки:** Только заглушка, нет реальных данных
4. **Фото продуктов:** UI готов, но обработка не реализована
5. **Нет автозаполнения:** Все данные вводятся вручную

### 7.2 Технические ограничения

1. **Нет пагинации:** Все отчеты загружаются сразу
2. **Фильтрация на клиенте:** При большом количестве данных может быть медленно
3. **Нет офлайн-режима:** Требуется постоянное подключение к интернету

---

## 8. Риски и митигация

### Риск 1: Пользователь забывает вводить данные
**Митигация:** Удобный интерфейс, быстрый ввод, визуальная мотивация через прогресс

### Риск 2: Ошибки при вводе данных
**Митигация:** Валидация перед сохранением, понятные сообщения об ошибках

### Риск 3: Потеря данных
**Митигация:** Upsert логика, обработка ошибок, проверка перед сохранением

---

## 9. Следующие шаги (Phase 2)

После MVP были реализованы:
1. Ролевая модель (client/coach)
2. Кабинет тренера
3. Переключатель типа дня
4. Просмотр клиентов тренером

---

# PRD - Product Requirements Document
# Phase 1: MVP - Цифровой дневник питания

**Версия:** 1.0.0  
**Дата:** Декабрь 2025  
**Статус:** Реализовано

---

## 1. Обзор продукта

**Название:** Fitness App MVP  
**Тип:** Web Application (PWA)  
**Платформа:** Web (Next.js 16, React 19)  
**Backend:** Supabase (PostgreSQL + Auth)

**Цель MVP:** Создать минимально жизнеспособный продукт для отслеживания питания клиентами тренеров.

---

## 2. Архитектура

### 2.1 Технологический стек

- **Frontend Framework:** Next.js 16 (App Router)
- **UI Library:** React 19
- **Styling:** Tailwind CSS v4
- **Backend:** Supabase
- **Authentication:** Supabase Auth
- **Database:** PostgreSQL (через Supabase)
- **Icons:** Lucide React

### 2.2 Структура приложения

```
src/app/
├── page.tsx              # Дашборд клиента (/)
├── login/
│   └── page.tsx          # Страница авторизации (/login)
├── nutrition/
│   └── page.tsx          # Ввод питания (/nutrition)
└── reports/
    └── page.tsx          # Отчеты (/reports)
```

---

## 3. Детальные требования к функциям

### 3.1 Авторизация (`/login`)

**Описание:** Страница входа в систему.

**Функциональность:**
- Форма с полями: email, password
- Валидация обязательных полей
- Обработка ошибок авторизации
- Автоматический редирект на дашборд при успешном входе
- Проверка существующей сессии при загрузке

**Технические детали:**
- Использует `supabase.auth.signInWithPassword()`
- Состояния: loading, error, success
- Редирект через `router.push('/')`

**UI:**
- Центрированная форма
- Сообщения об ошибках (красный фон)
- Сообщения об успехе (зеленый фон)
- Индикатор загрузки

---

### 3.2 Дашборд клиента (`/`)

**Описание:** Главная страница после авторизации.

**Компоненты:**

#### 3.2.1 Header
- Заголовок "Дашборд"
- Текущая дата (полный формат на русском)
- Кнопка выхода из системы

#### 3.2.2 Сводка по питанию за неделю
**Данные:**
- Логи за последние 7 дней из таблицы `daily_logs`
- Активные цели из таблицы `nutrition_targets` (где `day_type = 'training'`)

**Расчеты:**
```typescript
const totalCalories = weekLogs.reduce((sum, log) => sum + log.actual_calories, 0)
const daysLogged = weekLogs.length
const avgCalories = totalCalories / daysLogged

const targetCalories = targets.calories * daysLogged
const diff = totalCalories - targetCalories
```

**Отображение:**
- Статистика по калориям и белкам (StatCard)
- Индикатор дефицита/профицита (цветовая индикация)
- Количество дней с отчетами
- Кнопка "Ввести данные" → `/nutrition`

#### 3.2.3 Сводка по тренировкам
**Статус:** Заглушка (MVP)
**Отображение:**
- Информационное сообщение о том, что функция в разработке
- Метрики: Запланировано/выполнено (заглушка)
- Прогресс-бар выполнения

#### 3.2.4 Активные программы
**Данные:** Из таблицы `nutrition_targets`
**Фильтр:** `is_active = true`, `day_type = 'training'`
**Отображение:**
- Название программы
- КБЖУ цели
- Статус "Активна"

#### 3.2.5 Быстрые действия
- Кнопка "Ввести питание" → `/nutrition`
- Кнопка "Отчеты" → `/reports`

**Технические детали:**
- Загрузка данных при монтировании компонента
- Обработка ошибок загрузки
- Мемоизация расчетов через `useMemo`

---

### 3.3 Ввод питания (`/nutrition`)

**Описание:** Страница для ввода данных о питании за день.

**Функциональность:**

#### 3.3.1 Header
- Кнопка "← Назад" → `/`
- Заголовок "Ввод питания"
- Текущая дата

#### 3.3.2 Сводка целей
**Отображение:**
- Текущие калории / Цель калорий
- Progress bars для белков, жиров, углеводов
- Визуальная индикация (Flame icon: красный/зеленый)

**Логика:**
- Загрузка целей из `nutrition_targets` (где `day_type = 'training'`)
- Отображение прогресса относительно целей

#### 3.3.3 Управление приемами пищи

**Добавление:**
- Кнопка "+ Добавить прием пищи"
- Создание нового объекта `Meal` с дефолтными значениями
- Дефолтный вес: 100г

**Удаление:**
- Кнопка "Удалить" для каждого приема
- Минимум 1 прием всегда присутствует
- Кнопка отключена, если только 1 прием

**Редактирование:**
- Название приема пищи (текстовое поле)
- Все поля КБЖУ (числовые поля)

#### 3.3.4 Автоматические расчеты

**Реализация:**
```typescript
const totals = useMemo(() => {
  return meals.reduce((acc, meal) => ({
    calories: acc.calories + (meal.calories || 0),
    protein: acc.protein + (meal.protein || 0),
    fats: acc.fats + (meal.fats || 0),
    carbs: acc.carbs + (meal.carbs || 0)
  }), { calories: 0, protein: 0, fats: 0, carbs: 0 })
}, [meals])
```

**Отображение:**
- Обновление в реальном времени
- Отображение в сводке целей
- Итоговая строка: "Всего за день: X ккал, Б X / Ж X / У X г"

#### 3.3.5 Дополнительные данные

**Уровень голода:**
- Слайдер (range input) от 1 до 10
- Текстовое описание текущего значения
- Отображение подсказок: "Нет" - "Зверский"

**Комментарий:**
- Textarea для свободного текста
- Placeholder: "Как прошел день? Были срывы?"

#### 3.3.6 Сохранение

**Валидация:**
```typescript
if (totals.calories === 0 && totals.protein === 0 && totals.fats === 0 && totals.carbs === 0) {
  setSaveError('Введите данные хотя бы об одном приеме пищи')
  return
}
```

**Payload:**
```typescript
{
  user_id: user.id,
  date: today, // YYYY-MM-DD
  target_type: 'training',
  actual_calories: totals.calories,
  actual_protein: totals.protein,
  actual_fats: totals.fats,
  actual_carbs: totals.carbs,
  hunger_level: log.hunger_level,
  energy_level: log.energy_level,
  notes: log.notes
}
```

**Upsert:**
```typescript
await supabase
  .from('daily_logs')
  .upsert(payload, { onConflict: 'user_id, date' })
```

**Состояния:**
- `idle` → `saving` → `saved` → `idle`
- Визуальная обратная связь (изменение цвета кнопки)
- Редирект на дашборд после сохранения

---

### 3.4 Отчеты (`/reports`)

**Описание:** Просмотр истории отчетов.

**Функциональность:**

#### 3.4.1 Header
- Заголовок "Сводка"
- Подзаголовок "Отчеты по дням и неделям"
- Кнопка "← Назад" → `/`
- Кнопка выхода из системы

#### 3.4.2 Отчет за сегодня
**Логика:**
```typescript
const today = new Date().toISOString().split('T')[0]
const todayLog = logs.find(log => log.date === today)
```

**Отображение:**
- Отдельный блок "Сегодня"
- Статистика КБЖУ (4 карточки)
- Комментарий (если есть)

#### 3.4.3 Группировка по неделям
**Логика:**
```typescript
function getWeekKey(dateStr: string) {
  const date = new Date(dateStr)
  const firstDayOfYear = new Date(date.getFullYear(), 0, 1)
  const pastDaysOfYear = (date.valueOf() - firstDayOfYear.valueOf()) / 86400000
  const weekNumber = Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7)
  return `${weekNumber}`
}
```

**Отображение:**
- Заголовок: "Неделя X"
- Диапазон дат: "DD MMM — DD MMM"
- Список дней с данными:
  - Дата (DD MMM)
  - КБЖУ: "X ккал • Б X / Ж X / У X"
  - День недели (сокращенно)

**Технические детали:**
- Сортировка по дате (новые сверху)
- Форматирование дат на русском языке

---

## 4. Компоненты

### 4.1 MacroBar

**Описание:** Progress bar для макронутриентов.

**Props:**
```typescript
{
  label: string
  current: number
  target: number
  color: string // 'bg-blue-500' | 'bg-yellow-500' | 'bg-orange-500'
}
```

**Логика:**
```typescript
const percent = Math.min((current / target) * 100, 100)
```

**Отображение:**
- Метка (Белки/Жиры/Углеводы)
- Текущее значение / Цель
- Progress bar с цветом

### 4.2 InputGroup

**Описание:** Поле ввода для числовых значений.

**Props:**
```typescript
{
  label: string
  value: number
  onChange: (value: number) => void
}
```

**Логика:**
- Отображение пустого поля, если значение 0
- Преобразование ввода в число
- Обработка пустых значений как 0

**UI:**
- Белый фон, рамка
- Моноширинный шрифт для чисел
- Placeholder: "Введите значение"

### 4.3 StatCard

**Описание:** Карточка со статистикой.

**Props:**
```typescript
{
  label: string
  value: string
}
```

**Отображение:**
- Метка (серый текст, маленький)
- Значение (черный текст, крупный)

---

## 5. Обработка ошибок

### 5.1 Типы ошибок

1. **Ошибки авторизации:**
   - Неверные credentials
   - Отображение сообщения пользователю

2. **Ошибки загрузки данных:**
   - Сеть, права доступа
   - Логирование в консоль
   - Graceful degradation (пустые состояния)

3. **Ошибки сохранения:**
   - Валидация, конфликты
   - Отображение сообщения под кнопкой сохранения

4. **Отсутствие данных:**
   - Нет целей → сообщение "Тренер еще не назначил план питания"
   - Нет логов → сообщение "Нет данных за неделю"

### 5.2 Стратегии обработки

- Try-catch блоки вокруг всех async операций
- Проверка кодов ошибок Supabase (PGRST116 = нет строк)
- Отображение понятных сообщений пользователю
- Логирование ошибок в консоль для отладки

---

## 6. Производительность

### 6.1 Оптимизации

- Мемоизация расчетов через `useMemo`
- Ленивая загрузка данных только при необходимости
- Минимальное количество запросов к БД
- Параллельная загрузка данных через `Promise.all`

### 6.2 Ограничения

- Загрузка только последних 7 дней на дашборде
- Все отчеты загружаются на странице отчетов (может быть медленно при большом количестве)

---

## 7. Безопасность

### 7.1 Аутентификация

- Все запросы к БД проверяют авторизацию
- Row Level Security (RLS) должен быть настроен в Supabase
- Токены хранятся в браузере через Supabase SSR

### 7.2 Валидация данных

- Валидация на клиенте перед сохранением
- Проверка обязательных полей
- Типизация через TypeScript

---

## 8. UI/UX детали

### 8.1 Цветовая схема

- **Фон:** `bg-gray-50`
- **Карточки:** `bg-white` с тенью и рамкой
- **Акцент:** `bg-black` для кнопок
- **Успех:** `bg-green-600` для сохранено
- **Ошибка:** `bg-red-50` для сообщений об ошибках

### 8.2 Типографика

- **Заголовки:** `font-bold`, `text-xl` / `text-2xl`
- **Текст:** `text-sm` / `text-base`
- **Метки:** `text-xs`, `text-gray-400`
- **Числа:** `font-mono` для полей ввода

### 8.3 Интерактивность

- Hover эффекты на кнопках
- Активные состояния (scale, цвет)
- Плавные переходы (transition-all)
- Визуальная обратная связь при сохранении

---

## 9. Известные ограничения

1. **Фото продуктов:** UI готов, но обработка не реализована
2. **Тренировки:** Только заглушка
3. **Типы дней:** Только 'training', нет переключения (исправлено в Phase 2)
4. **Кабинет тренера:** Не реализован (исправлено в Phase 2)
5. **Автозаполнение КБЖУ:** Не реализовано

---

## 10. Следующие шаги (Phase 2)

После MVP были реализованы:
1. Ролевая модель (client/coach)
2. Кабинет тренера с системой светофора
3. Переключатель типа дня (training/rest)
4. Просмотр и редактирование клиентов тренером
5. Фильтры и сортировка в кабинете тренера

---

**Конец документации Phase 1**

