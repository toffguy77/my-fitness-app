# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è My Fitness App v3.4

## –û–±–∑–æ—Ä

My Fitness App ‚Äî —ç—Ç–æ Freemium SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏–µ–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è v3.4 –æ—Ç—Ä–∞–∂–∞–µ—Ç **—Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** –≤ –∫–æ–¥–µ (–ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ 17 –¥–µ–∫–∞–±—Ä—è 2025) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–π **Reliability & Safety**: Subscription Lifecycle UI, Notification Preferences –∏ Coach Input Guardrails.

---

## –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è v3.4

1. **Subscription Lifecycle UI:** –ì–ª–æ–±–∞–ª—å–Ω—ã–π –±–∞–Ω–Ω–µ—Ä –¥–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Premium —Ñ—É–Ω–∫—Ü–∏–π
2. **Notification Preferences:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ / –¥–∞–π–¥–∂–µ—Å—Ç), –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –±—É–¥—É—â–µ–≥–æ Cron-–≤–æ—Ä–∫–µ—Ä–∞
3. **Coach Input Guardrails:** –í–∞–ª–∏–¥–∞—Ü–∏—è nutrition_targets –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Zod + CHECK constraints), –≤–∏–∑—É–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ UI, –∑–∞—â–∏—Ç–∞ –æ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

## –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

*–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v3.2: Client (Free/Premium), Coach, Super Admin*

---

## –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

*–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v3.2: `/`, `/login`, `/register`*

---

## –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

### `/onboarding` ‚Äî –ú–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–§–∞–π–ª:** `src/app/onboarding/page.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- *–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ v3.4*
- 3 —à–∞–≥–∞: –ë–∏–æ–º–µ—Ç—Ä–∏—è, –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –¶–µ–ª—å
- –†–∞—Å—á–µ—Ç BMR/TDEE –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–π

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/dashboard` (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)

---

### `/app/dashboard` ‚Äî –î–∞—à–±–æ—Ä–¥ –∫–ª–∏–µ–Ω—Ç–∞

**–§–∞–π–ª:** `src/app/app/dashboard/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v3.4:**

#### 1. –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∏—Å—Ç–µ–∫—à–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ (NEW)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –≤–∏–¥–∂–µ—Ç–∞ –∑–∞–º–µ—Ç–∫–∏ —Ç—Ä–µ–Ω–µ—Ä–∞ (–µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞)
- **–£—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:** `subscription_status === 'expired'` –ò `!isPremium`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Ä—ã–π –±–ª–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π üîí
  - –¢–µ–∫—Å—Ç: "–ó–∞–º–µ—Ç–∫–∏ –æ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å –∞–∫—Ç–∏–≤–Ω–æ–π Premium –ø–æ–¥–ø–∏—Å–∫–æ–π."
  - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É" ‚Üí `/app/settings?tab=subscription`

#### 2. –ì–ª–æ–±–∞–ª—å–Ω—ã–π –±–∞–Ω–Ω–µ—Ä –ø–æ–¥–ø–∏—Å–∫–∏ (NEW)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –í–≤–µ—Ä—Ö—É –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü `/app/*` (—á–µ—Ä–µ–∑ `AppLayout`)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/components/SubscriptionBanner.tsx`
- **–£—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
  - –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ (`isExpired === true`)
  - –ò–õ–ò –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ (`status === 'cancelled'`), –Ω–æ –ø–µ—Ä–∏–æ–¥ –µ—â–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ñ–µ–ª—Ç—ã–π –±–∞–Ω–Ω–µ—Ä —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
  - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–ª–∏—Ç—å" ‚Üí `/app/settings?tab=subscription`
  - –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (—Å–∫—Ä—ã–≤–∞–µ—Ç –±–∞–Ω–Ω–µ—Ä –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–û—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
- –°–≤–æ–¥–∫–∞ –ö–ë–ñ–£ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
- –í–∏–¥–∂–µ—Ç –∑–∞–º–µ—Ç–∫–∏ —Ç—Ä–µ–Ω–µ—Ä–∞ (Premium)
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å"
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–µ–º–∞–º–∏ –ø–∏—â–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/settings` (–∫–Ω–æ–ø–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
- ‚Üí `/app/nutrition?date={selectedDate}` (–≤–≤–æ–¥/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è)
- ‚Üí `/app/reports` (–æ—Ç—á–µ—Ç—ã ‚Äî —Ç–æ–ª—å–∫–æ Premium)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç Premium —Ñ—É–Ω–∫—Ü–∏–∏
- –ë–∞–Ω–Ω–µ—Ä –Ω–µ–æ—Ç–∫–ª—é—á–∞–µ–º—ã–π (–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã—Ç—å)

---

### `/app/nutrition` ‚Äî –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –æ –ø–∏—Ç–∞–Ω–∏–∏

**–§–∞–π–ª:** `src/app/app/nutrition/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v3.4:**

#### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏ (NEW)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `ValidationWarning` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Å–∞ (> 0, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ > 10 –∫–≥)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ª–æ—Ä–∏–π (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ > 5000 –∫–∫–∞–ª)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–ª–∫–æ–≤/–∂–∏—Ä–æ–≤/—É–≥–ª–µ–≤–æ–¥–æ–≤ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ > 500 –≥)
  - –û—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç

#### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–Ω–µ–≤–Ω—ã—Ö totals (NEW)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ–¥ –±–ª–æ–∫–æ–º "–í—Å–µ–≥–æ –∑–∞ –¥–µ–Ω—å"
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ª–æ—Ä–∏–π: –º–∏–Ω–∏–º—É–º 1000, –º–∞–∫—Å–∏–º—É–º 6000 (–æ—à–∏–±–∫–∞), –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è < 1200 –∏ > 5000
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–ª–∫–æ–≤: –º–∏–Ω–∏–º—É–º 20, –º–∞–∫—Å–∏–º—É–º 500 (–æ—à–∏–±–∫–∞), –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è < 50 –∏ > 300
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏—Ä–æ–≤: –º–∏–Ω–∏–º—É–º 20, –º–∞–∫—Å–∏–º—É–º 200 (–æ—à–∏–±–∫–∞), –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è < 30 –∏ > 150
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≥–ª–µ–≤–æ–¥–æ–≤: –º–∏–Ω–∏–º—É–º 20, –º–∞–∫—Å–∏–º—É–º 500 (–æ—à–∏–±–∫–∞), –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è < 50 –∏ > 400
  - –û—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (`disabled={!dailyValidation.valid}`)

**–û—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `date` –∏–∑ URL
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `edit` –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–µ–º–∞
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–Ω—è
- –í–≤–æ–¥ –≤–µ—Å–∞ —Ç–µ–ª–∞
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–µ–º—ã –ø–∏—â–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/dashboard?date={selectedDate}` (–ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–ª–∏ –µ—Å–ª–∏ –¥–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω)
- ‚Üí `/login` (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `ValidationWarning` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

---

### `/app/reports` ‚Äî –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Ç–æ–ª—å–∫–æ Premium)

**–§–∞–π–ª:** `src/app/app/reports/page.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- *–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ v3.4*
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ª–æ–≥–æ–≤ –ø–æ –Ω–µ–¥–µ–ª—è–º
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ö–ë–ñ–£, –≤–µ—Å–∞, –∑–∞–º–µ—Ç–æ–∫

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/dashboard` (–∫–Ω–æ–ø–∫–∞ "‚Üê –ù–∞–∑–∞–¥")

---

### `/app/settings` ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è

**–§–∞–π–ª:** `src/app/app/settings/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v3.4:**

#### 1. –°–µ–∫—Ü–∏—è "–ü–æ–¥–ø–∏—Å–∫–∞" (UPDATED)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è
  - –ï—Å–ª–∏ `subscription_status === 'expired'`, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç "(–ò—Å—Ç–µ–∫–ª–∞)"
  - –ö—Ä–∞—Å–Ω—ã–π –±–ª–æ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `checkSubscriptionStatus()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

#### 2. –°–µ–∫—Ü–∏—è "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" (NEW)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/components/NotificationSettings.tsx`
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ "–ú–æ–∏ —Ü–µ–ª–∏", –ø–µ—Ä–µ–¥ —Å–µ–∫—Ü–∏–µ–π "–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã"
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞" (`email_daily_digest`, default: true)
  - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" (`email_realtime_alerts`, default: false)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `upsert` –≤ —Ç–∞–±–ª–∏—Ü—É `notification_settings`

**–û—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω)
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–Ω–µ—Ä–µ (–¥–ª—è Premium)
- –ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–ª–µ–π –ø–∏—Ç–∞–Ω–∏—è
- –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/dashboard` (–∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥")
- ‚Üí `/onboarding` (–µ—Å–ª–∏ –Ω–µ—Ç –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ)
- ‚Üí `/login` (–ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `checkSubscriptionStatus()` –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏

---

## –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–æ–≤

### `/app/coach` ‚Äî –ö–∞–±–∏–Ω–µ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞

**–§–∞–π–ª:** `src/app/app/coach/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v3.4:**

#### 1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (NEW)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ö–ª–∏–µ–Ω—Ç—ã —Å –∏—Å—Ç–µ–∫—à–µ–π –ø–æ–¥–ø–∏—Å–∫–æ–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º
  - –ü–æ–º–µ—Ç–∫–∞ "Expired" —Ä—è–¥–æ–º —Å –∏–º–µ–Ω–µ–º –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ `subscription_status === 'expired'`)

**–û—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å Traffic Light System v2
- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É (All / Red / Yellow / Green / Grey)
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É, –∏–º–µ–Ω–∏, –¥–∞—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–µ–∫–∏–Ω–∞
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –¥–∞—à–±–æ—Ä–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/coach/[clientId]` (–∫–ª–∏–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É)
- ‚Üí `/login` (–∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–µ—Ä—ã–º, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

---

### `/app/coach/[clientId]` ‚Äî –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞

**–§–∞–π–ª:** `src/app/app/coach/[clientId]/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v3.4:**

#### 1. –£–º–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (NEW)
- **–õ–æ–≥–∏–∫–∞:**
  - –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞
  - –ï—Å–ª–∏ `email_realtime_alerts === true`: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Edge Function
  - –ï—Å–ª–∏ `email_daily_digest === true` –ò `email_realtime_alerts === false`: –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å `pending_notifications`
  - –ï—Å–ª–∏ –æ–±–∞ `false`: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∏—á–µ–≥–æ
- **–¢–∞–±–ª–∏—Ü–∞ `pending_notifications`:**
  - –ü–æ–ª—è: `user_id`, `notification_type` ('coach_note'), `content` (JSONB), `sent_at`, `retry_count`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ Cron-–≤–æ—Ä–∫–µ—Ä–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

**–û—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- Date Picker –¥–ª—è –∑–∞–º–µ—Ç–æ–∫
- –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –∑–∞–º–µ—Ç–∫–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –≤ `coach_notes`
- Read-only –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–π –ø–æ –ø–∏—Ç–∞–Ω–∏—é (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π)

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/app/coach` (–∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥")

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∏–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏

---

## –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### `/admin` ‚Äî –ü–∞–Ω–µ–ª—å —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–§–∞–π–ª:** `src/app/admin/page.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- *–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ v3.4*
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π, –ø–æ–¥–ø–∏—Å–æ–∫, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç—Ä–µ–Ω–µ—Ä–æ–≤

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- ‚Üí `/login` (–∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞)

---

## –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤

### Middleware (`src/middleware.ts`)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- *–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ v3.4*
- –ó–∞—â–∏—Ç–∞ `/onboarding` (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
- –ó–∞—â–∏—Ç–∞ `/app/reports` (—Ç–æ–ª—å–∫–æ Premium)
- –ó–∞—â–∏—Ç–∞ `/app/coach` (—Ç–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–µ—Ä—ã)
- –ó–∞—â–∏—Ç–∞ `/admin` (—Ç–æ–ª—å–∫–æ super_admin)

---

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ v3.4

### Subscription Lifecycle Flow

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞—à–±–æ—Ä–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `checkSubscriptionStatus(userId)`
   - –ï—Å–ª–∏ `subscription_end_date < now` –ò `status !== 'expired'`, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –≤ –ë–î
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ `isExpired`

2. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –±–∞–Ω–Ω–µ—Ä:**
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö `/app/*` —á–µ—Ä–µ–∑ `AppLayout`
   - –ù–µ–æ—Ç–∫–ª—é—á–∞–µ–º—ã–π (–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã—Ç—å –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è `expired` –∏–ª–∏ `cancelled` (–µ—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –µ—â–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç)

3. **Downgrade Logic:**
   - –ò—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç Premium —Ñ—É–Ω–∫—Ü–∏–∏ (Coach Note Widget –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–æ–π)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Free User
   - –¢—Ä–µ–Ω–µ—Ä –≤–∏–¥–∏—Ç —Ç–∞–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–µ—Ä—ã–º–∏ –≤ —Å–ø–∏—Å–∫–µ

### Notification Preferences Flow

1. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
   - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/app/settings` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - `email_daily_digest: true`, `email_realtime_alerts: false`

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:**
   - –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏ —Ç—Ä–µ–Ω–µ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
   - –ï—Å–ª–∏ `realtime_alerts === true`: –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Edge Function
   - –ï—Å–ª–∏ `daily_digest === true`: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `pending_notifications`
   - –ï—Å–ª–∏ –æ–±–∞ `false`: –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

3. **–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - –¢–∞–±–ª–∏—Ü–∞ `pending_notifications` –¥–ª—è –±—É–¥—É—â–µ–≥–æ Cron-–≤–æ—Ä–∫–µ—Ä–∞
   - –ü–æ–ª—è: `user_id`, `notification_type`, `content` (JSONB), `sent_at`, `retry_count`

### Coach Input Guardrails Flow

1. **Server-side –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
   - API endpoint `/api/nutrition-targets/update` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Zod —Å—Ö–µ–º—É:
     - `calories`: min 1000, max 6000
     - `protein`: min 20, max 500
     - `fats`: min 20, max 200
     - `carbs`: min 20, max 500
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `validateNutritionTargets()`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `400 Bad Request` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

2. **Database constraints:**
   - CHECK constraints –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –æ–±—Ö–æ–¥–∞ API:
     - `check_calories_range`: 1000-6000
     - `check_protein_range`: 20-500
     - `check_fats_range`: 20-200
     - `check_carbs_range`: 20-500

3. **Client-side –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –í —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–ª–µ–π (`ClientDashboardView`) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `ValidationWarning`
   - –ö—Ä–∞—Å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—à–∏–±–æ–∫

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Frontend:** Next.js 16 (App Router), React 19, Tailwind CSS v4
- **Backend:** Supabase (Authentication, Database, RLS)
- **Validation:** Zod –¥–ª—è server-side –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **State Management:** React Hooks (useState, useEffect, useMemo)
- **Routing:** Next.js App Router —Å middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
- **Icons:** Lucide React

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (v3.4):

**Table: `notification_settings`**
- `user_id`: UUID (PRIMARY KEY, FK to profiles)
- `email_daily_digest`: BOOLEAN (default: true)
- `email_realtime_alerts`: BOOLEAN (default: false)
- `created_at`: TIMESTAMPTZ
- `updated_at`: TIMESTAMPTZ

**Table: `pending_notifications`**
- `id`: UUID (PRIMARY KEY)
- `user_id`: UUID (FK to profiles)
- `notification_type`: TEXT (CHECK: 'coach_note', 'check_in_reminder', 'weekly_digest')
- `content`: JSONB
- `created_at`: TIMESTAMPTZ
- `sent_at`: TIMESTAMPTZ (NULL –µ—Å–ª–∏ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
- `retry_count`: INTEGER (default: 0)

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü (v3.4):

**Table: `profiles`**
- –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å `'expired'` –≤ enum `subscription_status`
- –¢—Ä–∏–≥–≥–µ—Ä `update_subscription_status_on_expiry` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**Table: `nutrition_targets`**
- –î–æ–±–∞–≤–ª–µ–Ω—ã CHECK constraints:
  - `check_calories_range`: 1000-6000
  - `check_protein_range`: 20-500
  - `check_fats_range`: 20-200
  - `check_carbs_range`: 20-500

#### –ú–∏–≥—Ä–∞—Ü–∏—è:
- –§–∞–π–ª: `docs/migrations/v3.4_add_reliability_features.sql`
- –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã `notification_settings` –∏ `pending_notifications`
- –î–æ–±–∞–≤–ª—è–µ—Ç CHECK constraints –¥–ª—è `nutrition_targets`
- –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Row Level Security (RLS)** –≤ Supabase:
  - `notification_settings`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - `pending_notifications`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä)
- **Server-side –≤–∞–ª–∏–¥–∞—Ü–∏—è:** Zod —Å—Ö–µ–º–∞ + CHECK constraints –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **Client-side –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

- **Mobile First –ø–æ–¥—Ö–æ–¥:** –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–¥–∞–ø—Ç–∏–≤–Ω—ã
- SubscriptionBanner –∞–¥–∞–ø—Ç–∏–≤–µ–Ω
- NotificationSettings –∞–¥–∞–ø—Ç–∏–≤–µ–Ω
- ValidationWarning –∞–¥–∞–ø—Ç–∏–≤–µ–Ω

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### `SubscriptionBanner` (`src/components/SubscriptionBanner.tsx`) (NEW)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –±–∞–Ω–Ω–µ—Ä –¥–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö/–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ `checkSubscriptionStatus()`
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–ª–∏—Ç—å" –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –±–∞–Ω–Ω–µ—Ä–∞

### `NotificationSettings` (`src/components/NotificationSettings.tsx`) (NEW)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏ –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

### `ValidationWarning` (`src/components/ValidationWarning.tsx`)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ö –ø–∏—Ç–∞–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–ª–µ–π

### `DayToggle` (`src/components/DayToggle.tsx`)
- *–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ v3.4*

### `Paywall` (`src/components/Paywall.tsx`)
- *–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ v3.4*

### `ClientDashboardView` (`src/components/ClientDashboardView.tsx`)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v3.4:**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π API endpoint `/api/nutrition-targets/update` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç `ValidationWarning` –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ü–µ–ª–µ–π
  - –ö—Ä–∞—Å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## –£—Ç–∏–ª–∏—Ç—ã

### `src/utils/supabase/subscription.ts` (NEW)
- `checkSubscriptionStatus(userId)`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
- `isPremiumUser(userId)`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Premium

### `src/utils/validation/nutrition.ts` (NEW)
- `validateMeal(meal)`: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
- `validateDailyTotals(calories, protein, fats, carbs)`: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–Ω–µ–≤–Ω—ã—Ö totals
- `validateNutritionTargets(input)`: –í–∞–ª–∏–¥–∞—Ü–∏—è nutrition_targets –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞

### `src/utils/supabase/server.ts` (NEW)
- `createClient()`: Server-side Supabase client –¥–ª—è API Routes –∏ Server Actions

---

## API Routes

### `/api/nutrition-targets/update` (NEW)
**–§–∞–π–ª:** `src/app/api/nutrition-targets/update/route.ts`

**–ú–µ—Ç–æ–¥:** POST

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–µ—Ä—ã –∏ super_admin)

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- Zod —Å—Ö–µ–º–∞ –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `validateNutritionTargets()`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (—Ç—Ä–µ–Ω–µ—Ä –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Ü–µ–ª–∏ —Å–≤–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)

**–û—Ç–≤–µ—Ç—ã:**
- `200 OK`: –¶–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- `400 Bad Request`: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
- `401 Unauthorized`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403 Forbidden`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ç—Ä–µ–Ω–µ—Ä–æ–º –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω —ç—Ç–æ–º—É —Ç—Ä–µ–Ω–µ—Ä—É
- `500 Internal Server Error`: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **Subscription Lifecycle:** –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞—à–±–æ—Ä–¥–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

2. **Notification Preferences:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

3. **Coach Input Guardrails:** –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Ç—Ä–µ—Ö —É—Ä–æ–≤–Ω—è—Ö:
   - –ö–ª–∏–µ–Ω—Ç (–≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)
   - –°–µ—Ä–≤–µ—Ä (Zod + –∫–∞—Å—Ç–æ–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (CHECK constraints)

4. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `docs/migrations/v3.4_add_reliability_features.sql` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

5. **Pending Notifications:** –¢–∞–±–ª–∏—Ü–∞ `pending_notifications` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ Cron-–≤–æ—Ä–∫–µ—Ä–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤. –ü–æ–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

6. **Expired Subscriptions:** –ò—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä –ë–î –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `subscription_end_date` –∏–ª–∏ `subscription_status`.

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 17 –¥–µ–∫–∞–±—Ä—è 2025 (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ v3.4)*

