# BRD - Business Requirements Document
# Phase 4: Улучшения UX и визуализация данных

**Версия:** 4.0.0  
**Дата:** Январь 2025  
**Статус:** Планирование  
**Предыдущая версия:** Phase 3 v3.0.0

---

## 1. Бизнес-контекст

### 1.1 Проблема текущей реализации

После Phase 3 были выявлены следующие проблемы:

1. **Устаревшие паттерны UI:**
   - Использование `alert()` вместо современных toast-уведомлений
   - Нет индикаторов загрузки в некоторых местах
   - Плохое восприятие скорости работы приложения

2. **Отсутствие визуализации данных:**
   - Нет графиков для отслеживания прогресса
   - Отчеты показывают только списки без визуализации
   - Сложно понять тренды и изменения

3. **Ограниченная функциональность отчетов:**
   - Нет экспорта данных
   - Нет поиска и фильтрации
   - Нет сравнения периодов

4. **Производительность:**
   - Загрузка всех данных сразу может быть медленной
   - Нет пагинации для больших списков

### 1.2 Целевое состояние

**Улучшенный UX:**
- Современные toast-уведомления вместо alert
- Понятные индикаторы загрузки
- Оптимистичные обновления для лучшего восприятия скорости

**Визуализация прогресса:**
- Графики веса и КБЖУ
- Прогресс-бары для визуализации выполнения целей
- Улучшенная страница отчетов с вкладками и фильтрами

**Расширенная функциональность:**
- Экспорт данных в различных форматах
- Поиск и фильтрация в отчетах
- Пагинация для оптимизации производительности

---

## 2. Функциональные требования

### 2.1 Система toast-уведомлений

**Требование:** Заменить все `alert()` на современные toast-уведомления.

#### 2.1.1 Типы toast

1. **Success** — успешные операции (зеленый)
2. **Error** — ошибки (красный)
3. **Warning** — предупреждения (желтый)
4. **Info** — информационные сообщения (синий)

#### 2.1.2 Функциональность

- Автоматическое скрытие через 3-5 секунд
- Возможность закрыть вручную
- Позиционирование (top-right по умолчанию)
- Анимации появления/исчезновения
- Очередь для множественных уведомлений

**Приоритет:** Высокий

---

### 2.2 Улучшение индикаторов загрузки

**Требование:** Добавить единообразные индикаторы загрузки.

#### 2.2.1 Компоненты

1. **LoadingSpinner** — спиннер для кнопок и небольших элементов
2. **SkeletonLoader** — skeleton для списков и карточек
3. **PageLoader** — полноэкранный индикатор загрузки

**Приоритет:** Средний

---

### 2.3 Визуализация данных

**Требование:** Добавить графики и диаграммы для визуализации прогресса.

#### 2.3.1 График веса

- Линейный график веса за период
- Выбор периода (7 дней, 30 дней, 3 месяца, все время)
- Трендовая линия
- Точки данных с hover информацией

**Приоритет:** Высокий

#### 2.3.2 Графики КБЖУ

- График калорий за период (линейный)
- График макронутриентов (столбчатый или линейный)
- Сравнение с целями (линия цели на графике)
- Выбор периода

**Приоритет:** Высокий

#### 2.3.3 Прогресс-бары

- Визуализация прогресса по каждому макронутриенту
- Цветовая индикация (зеленый/желтый/красный)
- Процент выполнения цели
- Анимация заполнения

**Приоритет:** Высокий

---

### 2.4 Улучшение страницы отчетов

**Требование:** Переработать страницу отчетов с вкладками, фильтрами и группировкой.

#### 2.4.1 Вкладки

- **Графики** — визуализация данных
- **Таблица** — детальная таблица логов
- **Статистика** — сводная статистика за период

#### 2.4.2 Фильтры

- Фильтр по диапазону дат (календарь)
- Фильтр по типу дня (training/rest)
- Сортировка (по дате, калориям, весу)

#### 2.4.3 Группировка

- По неделям
- По месяцам
- По годам

**Приоритет:** Высокий

---

### 2.5 Экспорт данных

**Требование:** Добавить возможность экспорта данных.

#### 2.5.1 Форматы экспорта

1. **CSV** — для Excel и других табличных редакторов
2. **JSON** — для программной обработки
3. **PDF** — для печати и архива (опционально)

#### 2.5.2 Данные для экспорта

- Daily logs (КБЖУ, вес, даты)
- Nutrition targets (цели питания)
- Coach notes (заметки тренера)

**Приоритет:** Средний

---

### 2.6 Оптимистичные обновления UI

**Требование:** Обновлять UI до получения ответа от сервера.

#### 2.6.1 Применение

- Сохранение питания
- Сохранение заметок тренера
- Обновление веса
- Откат при ошибке

**Приоритет:** Средний

---

### 2.7 Пагинация

**Требование:** Добавить пагинацию для больших списков.

#### 2.7.1 Применение

- Страница отчетов
- Админ панель (список пользователей)

#### 2.7.2 Функциональность

- Пагинация по 20-50 записей на страницу
- Индикатор загрузки следующей страницы
- Бесконечная прокрутка (опционально)

**Приоритет:** Средний

---

## 3. Технические требования

### 3.1 Зависимости

```json
{
  "recharts": "^2.10.0",
  "react-hot-toast": "^2.4.1",
  "papaparse": "^5.4.1",
  "jspdf": "^2.5.1"
}
```

### 3.2 Новые компоненты

- `src/components/Toast.tsx`
- `src/components/ToastProvider.tsx`
- `src/components/LoadingSpinner.tsx`
- `src/components/SkeletonLoader.tsx`
- `src/components/charts/WeightChart.tsx`
- `src/components/charts/MacrosChart.tsx`
- `src/components/ProgressBar.tsx`
- `src/components/Pagination.tsx`

### 3.3 Новые утилиты

- `src/utils/export.ts` — экспорт данных
- `src/utils/cache.ts` — кэширование (опционально)

---

## 4. Пользовательские сценарии

### Сценарий 1: Просмотр прогресса веса

1. Пользователь открывает страницу отчетов
2. Переходит на вкладку "Графики"
3. Выбирает график "Вес"
4. Выбирает период "30 дней"
5. Видит график с трендовой линией
6. Наводит курсор на точку данных
7. Видит детальную информацию (дата, вес)

### Сценарий 2: Экспорт данных

1. Пользователь открывает страницу отчетов
2. Нажимает кнопку "Экспорт"
3. Выбирает формат (CSV/JSON/PDF)
4. Выбирает период данных
5. Нажимает "Скачать"
6. Получает файл с данными

### Сценарий 3: Использование toast вместо alert

1. Пользователь сохраняет данные о питании
2. Вместо alert появляется toast-уведомление "Данные сохранены"
3. Toast автоматически исчезает через 3 секунды
4. Пользователь может закрыть его вручную

---

## 5. Метрики успеха

### Количественные метрики:
- Увеличение времени на сайте на 20%+
- Увеличение частоты использования отчетов на 30%+
- Снижение времени загрузки страниц на 15%+

### Качественные метрики:
- Улучшение восприятия скорости работы приложения
- Повышение вовлеченности через визуализацию прогресса
- Улучшение UX через современные паттерны

---

## 6. Известные ограничения

1. **Графики:** Требуют библиотеку recharts (увеличивает размер bundle)
2. **PDF экспорт:** Требует дополнительную библиотеку jspdf
3. **Производительность графиков:** При большом количестве данных может быть медленно

---

## 7. Риски и митигация

### Риск 1: Большие библиотеки для графиков
**Митигация:** Использовать легковесные библиотеки (recharts), code splitting, lazy loading компонентов

### Риск 2: Производительность графиков при большом количестве данных
**Митигация:** Ограничение данных на графике (максимум 365 точек), агрегация данных, виртуализация

### Риск 3: Сложность интеграции toast системы
**Митигация:** Использовать готовую библиотеку (react-hot-toast), постепенная миграция

---

## 8. План реализации

### Недели 1-2: UX улучшения
1. Установить react-hot-toast
2. Создать ToastProvider
3. Заменить все alert() на toast
4. Создать LoadingSpinner и SkeletonLoader
5. Интегрировать индикаторы загрузки

### Недели 3-5: Визуализация данных
1. Установить recharts
2. Создать WeightChart компонент
3. Создать MacrosChart компонент
4. Создать ProgressBar компонент
5. Интегрировать графики в reports и dashboard
6. Переработать страницу reports

### Недели 6-7: Дополнительная функциональность
1. Создать утилиты экспорта данных
2. Добавить кнопки экспорта в reports и settings
3. Реализовать поиск и фильтрацию
4. Добавить пагинацию
5. Реализовать оптимистичные обновления

### Неделя 8: Финальная полировка
1. Интеграционное тестирование
2. Обновление документации
3. Code review и рефакторинг

---

**Конец документации Phase 4**

